<div class="container">
  <div class="row">
    <div class="d-flex justify-content-between w-100 my-3">
      <h4 class="bg-light">ショッピングカート</h4>
      <% unless @cart_items.blank? %>
        <%= link_to 'カートを空にする', cart_items_destroy_all_path, method: :delete, class:"btn btn-sm btn-danger" %>
      <% end %>
    </div>

    <% if @cart_items.blank? %>
      <h3 class="text-center">カートの中は空です</h3>
    <% else %>
      <table class="table table-bordered">
        <thead class="table-secondary">
          <tr>
            <td class="col-4">商品名</td>
            <td class="col-2">単価(税込)</td>
            <td class="col-2">数量</td>
            <td class="col-2">小計</td>
            <td class="col-2"></td>
          </tr>
        </thead>
        <tbody>
          <% @cart_items.each do |cart_item| %>
          <tr>
            <td>
              <%= attachment_image_tag cart_item.item, :image, :fill,50,50 %><%= cart_item.item.name %>
            </td>
            <td><%= (cart_item.item.add_tax_price).to_s(:delimited) %></td>
            <%= form_with url: cart_item_path(cart_item), method: :patch, local: true do |f| %>
            <td>
              <%= f.select :quantity, [*1..10], selected: cart_item.quantity %>
              <%= hidden_field_tag :item_id, cart_item.item_id %>
              <%= f.submit '変更', class:"btn btn-sm btn-success" %>
            </td>
            <% end %>
            <td><%= (cart_item.item.add_tax_price * cart_item.quantity.to_i).to_s(:delimited) %></td>
            <td>
              <%= link_to '削除する', cart_item_path(cart_item), method: :delete, class:"btn btn-sm btn-danger" %>
            </td>
            <% (@sum += cart_item.item.add_tax_price * cart_item.quantity.to_i).to_s(:delimited) %> <!--小計を足していって合計を求める-->
          </tr>
          <% end %>
        </tbody>
      </table>

      <div class="d-flex justify-content-between w-100">
        <div classs="col-2"><%= link_to "買い物を続ける", items_path, class:"btn btn-sm btn-primary h-50 w-20" %></div>
        <div>
        <table class="table table-bordered">
          <tr>
            <td scope="row" class="table-secondary">合計金額</td>
            <td><%= @sum.to_s(:delimited) %></td>
          </tr>
        </table>
        </div>
      </div>
      <div class="mx-auto">
        <%= link_to '情報入力に進む', new_order_path, class:"btn  btn-success" %>
      </div>
    <% end %>
  </div>
</div>
